<!DOCTYPE html>
<html>
<head>
	<title> Airlines Graph Render </title>
	<script src="sigma.min.js"></script> <!-- OK -->
	<script src"src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script><!-- OK -->

	<script src="plugins/sigma.layout.forceAtlas2/worker.js"></script><!-- OK -->
  <script src="plugins/sigma.layout.forceAtlas2/supervisor.js"></script><!-- OK -->
  <script src="plugins/sigma.renderers.edgeLabels/settings.js"></script><!-- OK -->
  <script src="plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.curve.js"></script><!-- OK -->
  <script src="plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.def.js"></script><!-- OK -->
  <script src="plugins/sigma.renderers.edgeLabels/sigma.canvas.edges.labels.curvedArrow.js"></script><!-- OK -->
  <script src="plugins/sigma.plugins.dragNodes/sigma.plugins.dragNodes.js"></script><!-- OK -->
  <script src="plugins/sigma.plugins.animate/sigma.plugins.animate.js"></script><!-- OK -->
<!-- JQUERY-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- JSOC -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.min.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.css" />
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-flat.css" />
	<style>
		body,html{
			width: 100%;
			margin: 0px;
			padding: 0px;
			height: 100%
		}
	    #graph-container {
	      width:80%;
        margin-left: 20%;
	      height: 100%;
        position: static;
	    }

      #viserion {
        z-index: 2;
        position: static;
        float: right;
        border: 2px;
        width: 240px;
        height: 150px;
        top:100vh;
        margin-top: -150px;
        background-color: red;
      }

      #detail-container {
        float: left;
        width: 20%;
        background-color: grey;
        border-left: black, solid, 2px;
        height: 100%;
      }

    .img-top {
      width: 100%;
      margin: 0;
      padding: 0;
    }

    .txt {
      height: 75%;
    }
/*swap between #holdinjected and #default-txt with javascript */
    #holdinjected {
      visibility: hidden;
    }

    #default-txt {
      height: 80%;
    }

    .footer {
      height: 20%;
      position: fixed;
      bottom: 0;
    }
  </style>
</head>
<body>
    <div id="detail-container">
      <div class="static">
        <img src="https://kuleuvencongres.be/eusea/images/kuleuven-logo-2012.png/image" alt="KUL" class="img-top">
        <img src="http://be.dariah.eu/sites/all/themes/dariah_be/logo.png" alt="Dariah-BE" class="img-top">
      </div>
      <div class="txt">

      <div id="holdinjected">

      </div>

      <div id="default-txt">
        <p id="default-msg">For more details on a given node, click it. Details appear here. </p>
      </div>


      <div class="footer">
        <p>If Trismegistos helped you, share and <a href="http://www.trismegistos.org/about_how_to_cite" target="_blank">cite</a> us.</p>
        <div id="share"></div> <!-- JSOC Injection -->
      </div>
      </div>
    </div>


	  <div id="graph-container"></div>
    <div id=viserion></div>


	<script >

		var graph = {
			    "nodes": [
			        {
			            "city": "Dallas",
			            "area": 999,
			            "code": 214,
			            "country": "USA"
			        },
			        {
			            "city": "Austin",
			            "area": 1180,
			            "code": 512,
			            "country": "USA"
			        },
			        {
			            "city": "New York",
			            "area": 1214,
			            "code": 646,
			            "country": "USA"
			        },
			        {
			            "city": "Washington",
			            "area": 176,
			            "code": 564,
			            "country": "USA"
			        },
			        {
			            "city": "Atlanta",
			            "area": 342,
			            "code": 518,
			            "country": "USA"
			        },
			        {
			            "city": "Huston",
			            "area": 1625,
			            "code": 281,
			            "country": "USA"
			        },
			        {
			            "city": "Chicago",
			            "area": 606,
			            "code": 312,
			            "country": "USA"
			        },
			        {
			            "city": "London",
			            "area": 909,
			            "code": 312,
			            "country": "England"
			        }
			    ],
			    "edges": [
			        {
			            "key": 1,
			            "source": "Dallas",
			            "destination": "Austin",
			            "distance": 200,
			            "airlines": "British Airways",
			            "fare": 220
			        },
			        {
			            "key": 2,
			            "source": "Austin",
			            "destination": "Dallas",
			            "distance": 200,
			            "airlines": "Lufthansa",
			            "fare": 120
			        },
			        {
			            "key": 3,
			            "source": "Washington",
			            "destination": "Dallas",
			            "distance": 1300,
			            "airlines": "Lufthansa",
			            "fare": 300
			        },
			        {
			            "key": 4,
			            "source": "Atlanta",
			            "destination": "Washington",
			            "distance": 600,
			            "airlines": "Lufthansa",
			            "fare": 600
			        },
			        {
			            "key": 5,
			            "source": "Washington",
			            "destination": "Atlanta",
			            "distance": 600,
			            "airlines": "KLM",
			            "fare": 400
			        },
			        {
			            "key": 6,
			            "source": "New York",
			            "destination": "Atlanta",
			            "distance": 300,
			            "airlines": "Qatar",
			            "fare": 1300
			        },
			        {
			            "key": 7,
			            "source": "Huston",
			            "destination": "Atlanta",
			            "distance": 800,
			            "airlines": "Indigo",
			            "fare": 400
			        },
			        {
			            "key": 8,
			            "source": "Atlanta",
			            "destination": "Huston",
			            "distance": 800,
			            "airlines": "Spicejet",
			            "fare": 600
			        },
			        {
			            "key": 9,
			            "source": "New York",
			            "destination": "Chicago",
			            "distance": 1000,
			            "airlines": "Air China",
			            "fare": 500
			        },
			        {
			            "key": 10,
			            "source": "Chicago",
			            "destination": "New York",
			            "distance": 1000,
			            "airlines": "Jet Airways",
			            "fare": 200
			        },
			        {
			            "key": 11,
			            "source": "Dallas",
			            "destination": "Chicago",
			            "distance": 900,
			            "airlines": "Lufthansa",
			            "fare": 1300
			        },
			        {
			            "key": 12,
			            "source": "Austin",
			            "destination": "Huston",
			            "distance": 160,
			            "airlines": "Lufthansa",
			            "fare": 240
			        },
			        {
			            "key": 13,
			            "source": "Dallas",
			            "destination": "New York",
			            "distance": 780,
			            "airlines": "Lufthansa",
			            "fare": 300
			        },
              {
                "key": 14,
                "source": "London",
                "destination": "New York",
                "distance": 900,
                "airlines": "Ryanair",
                "fare": 450
              }
			    ]
			};
		var g = {
			nodes:[],
			edges:[]
		}

	// Generate a random graph:

			colors = [
		      'rgb(97,125,180)',
		      'rgb(102,143,60)',
		      'rgb(198,88,62)',
		      'rgb(185,86,175)'
		    ];
		 sigma.utils.pkg('sigma.canvas.nodes');
		 sigma.canvas.nodes.border = function(node, context, settings) {
			  var prefix = settings('prefix') || '';



			  context.beginPath();
 			  context.arc(
			    node[prefix + 'x']+15,
			    node[prefix + 'y'],
			    node[prefix + 'size']-2,
			    0,
			    Math.PI * 2,
			    true
			  );
			  //context.fillStyle = "orange";
			  context.strokeStyle = node.color || settings('defaultNodeColor');
			  //get the data from the group
			  //var data = d3.select(this).data();
			  context.stroke();
			  //context.fill();
			  context.font = "10px Arial";
			  context.fillStyle = "black";
			  context.strokeStyle = "black";
			  //write the text in the context
			  context.fillText(10,node[prefix + 'x']+15+ 10,  node[prefix + 'size']-2-15);




			  // Adding a border
			  //context.lineWidth = node.borderWidth || 1;
			  //context.strokeStyle = node.borderColor || '#fff';
			  //context.stroke();



			  context.fillStyle = node.color || settings('defaultNodeColor');
			  context.beginPath();
			  context.arc(
			    node[prefix + 'x'],
			    node[prefix + 'y'],
			    node[prefix + 'size'],
			    0,
			    Math.PI * 2,
			    true
			  );

			 context.closePath();
			 context.fill();



			};




		for (var i = 0; i < graph.nodes.length; i++)
		  g.nodes.push({
		    id: graph.nodes[i]['city'],
		    label: graph.nodes[i]['city'],
        country: graph.nodes[i]["country"],
        area_t: graph.nodes[i]["area"],
        code: graph.nodes[i]["code"],
		    x: Math.random(),
		    y: Math.random(),
		    size: 8,
		    color: colors[Math.floor(Math.random() * colors.length)],
				opacity: 0.5,
		  });

		for (var i = 0; i < graph.edges.length; i++)
		  g.edges.push({
		    id: graph.edges[i]['key'],
		    source: graph.edges[i]['source'],
		    target: graph.edges[i]['destination'],
        distance: graph.edges[i]['distance'],
        airlines: graph.edges[i]['airlines'],
        fare: graph.edges[i]['fare'],
		    size: 8,
		    label:graph.edges[i]['airlines'],
		    color: '#668e3e',
		    type:'curvedArrow'
		  });

		s = new sigma({
		  graph: g,
		  renderer: {
		    container: document.getElementById('graph-container'),
		    type: 'canvas'
		  },
		  settings: {
		    edgeLabelSize: 'proportional',
		    minNodeSize: 1,
		    maxNodeSize: 10,
		    minEdgeSize: 0.1,
		    maxEdgeSize: 2,
		    enableEdgeHovering: true,
		    edgeHoverSizeRatio: 2,
		    //defaultNodeType: 'border',
		    defaultNodeColor:"#fff",
			  mouseEnabled: true,
        touchEnabled: true
		  }
		});

    m = new sigma({
      graph: g,
		  renderer: {
		    container: document.getElementById('viserion'),
		    type: 'canvas'
		  },
		  settings: {
		    edgeLabelSize: 'relative',
		    minNodeSize: 0.5,
		    maxNodeSize: 5,
		    minEdgeSize: 0.05,
		    maxEdgeSize: 1,
		    enableEdgeHovering: false,
		    edgeHoverSizeRatio: 1,
		    defaultNodeColor:"#fff",
			  mouseEnabled: false,
        touchEnabled: false,
        drawLabels: false,
        drawEdgeLabels: false,
		  }
		});

    console.log((m));

		//s.settings('autoRescale', false)

		s.startForceAtlas2({worker: true, barnesHutOptimize: false, linLogMode:true, edgeWeightInfluences:1, slowDown:50, startingIterations:100});
		//s.stopForceAtlas2();
    setTimeout(function() {s.killForceAtlas2(); }, 3000);

// custom code (show node information)
    s.bind("clickNode", function (e) {
      console.log("test nodeclick");
      console.log(e.data.node.country, e.data.node.label, e.data.node.area_t, e.data.node.code);
      document.getElementById("holdinjected").innerHTML = "<h2>Node info</h2> <p>Country: "+ e.data.node.country + "</p> <p>Name: "+e.data.node.label+"</p> <p>Area: "+e.data.node.area_t+"</p><p>Code: "+e.data.node.code+"</p>";
      document.getElementById("default-txt").style.visibility = "hidden";
      document.getElementById("holdinjected").style.visibility = "visible";
    });

// custom edgeclick
    s.bind("clickEdge", function(e) {
      console.log("test edgeclick");
      document.getElementById("holdinjected").innerHTML = "<h2>Edge info</h2> <p>Departure: <a href ='https://www.google.be/search?q="+e.data.edge.source+"' target='_blank'>"+ e.data.edge.source + "</a></p> <p>Destination: "+ e.data.edge.target +"</p> <p>Distance: "+e.data.edge.distance+"</p><p>Airline: "+e.data.edge.airlines+"</p><p>Fare: "+e.data.edge.fare+"</p>";
      document.getElementById("default-txt").style.visibility = "hidden";
      document.getElementById("holdinjected").style.visibility = "visible";

    })

// custom backgroundclick.
    s.bind("clickStage", function(){
      document.getElementById("default-txt").style.visibility = "visible";
      document.getElementById("holdinjected").style.visibility = "hidden";
      document.getElementById("holdinjected").innerHTML = "";     // emptying div
    })

// Enable drag functionality.
    sigma.plugins.dragNodes(s, s.renderers[0]);


// JSOC injection caller
    $("#share").jsSocials({
        shares: ["email", "twitter", "facebook", "googleplus"]
    });



	</script>

</body>
</html>
